<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Barcode Scanner</title>

  <!-- âœ… FIXED CSS PATH -->
  <link rel="stylesheet" href="./style.css" />

  <!-- âœ… SIMPLE AUTH GUARD -->
  <script>
    // If user is not logged in, go back to signin page
    if (!localStorage.getItem("user")) {
      window.location.href = "../login-UI/signin.html";
    }
  </script>
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="header">
  <div class="header-left">
    <div class="logo">â¬š</div>
    <span class="title" id="dashboard-title">Dashboard</span>
  </div>

  <div class="header-right">
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</header>

<!-- ================= MAIN ================= -->
<main class="container">

  <!-- ================= SCAN ================= -->
  <div class="card scan-card">
    <h3>Scan Barcode</h3>

    <button id="scanBtn" class="scan-btn" onclick="openScanner()">
        ðŸ“· Open Camera Scanner
    </button>

    <button class="scan-btn upload-scan-btn">
        ðŸ“‚ Upload Stock Excel
        <input type="file" id="stockUpload" accept=".xlsx,.xls">
    </button>



    <div class="divider">OR ENTER MANUALLY</div>

    <div class="manual-row">
      <input id="barcode-input" placeholder="Enter barcode..." />
      <button class="save-btn" onclick="saveBarcode()">Save</button>
    </div>
  </div>

  <!-- ================= TABS ================= -->
  <div class="tabs">
    <button class="tab active" onclick="showTab('my', this)">My Barcodes</button>
    <button class="tab" onclick="showTab('common', this)">Common Summary</button>
    <button class="tab" onclick="showTab('audit', this)">Audit Compare</button>
  </div>

<!-- ================= MY BARCODES ================= -->
<div id="my" class="card tab-content">

  <div id="paginationBox" class="pagination"></div>

  <div class="card-header">
    <h3>My Barcodes</h3>
    
    <div class="header-actions">
      <div id="paginationMy" class="pagination"></div>
      
      <button class="excel-btn" onclick="downloadMyBarcodesExcel()">
        ðŸ“Š Download Excel
      </button>
    </div>
  </div>


  <div class="search-row">
    <input id="searchInput" class="search-input" placeholder="Search barcode..." onkeyup="searchBarcode()">
    <button class="clear-btn" onclick="clearSearch()">Clear</button>
  </div>

  <table>
    <thead>
        <tr>
          <th>
            <input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)">
            Barcode
          </th>
          <th>Item Name</th>
          <th>Book Count</th>
          <th>Physical Count</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
    </thead>

    <tbody id="myBarcodesBody"></tbody>
  </table>

</div>

<!-- ================= COMMON SUMMARY ================= -->
<div id="common" class="card tab-content hidden">

  <div id="floatingCommonDelete" class="floating-delete hidden">
    <button class="floating-delete-btn" onclick="deleteSelectedCommon()">
      ðŸ—‘ Delete Selected (<span id="commonDeleteCount">0</span>)
    </button>
  </div>


  <div class="card-header">
    <h3>Common Summary</h3>

    <div class="header-actions">
      <div id="paginationCommon" class="pagination"></div>
    <button class="excel-btn" onclick="downloadCommonSummaryExcel()">
      ðŸ“Š Download Excel
    </button>
    </div>
  </div>

  <div class="search-row">
    <input id="commonSearchInput" class="search-input" placeholder="Search barcode in summary..." onkeyup="searchCommonSummary()">
    <button class="clear-btn" onclick="clearCommonSearch()">Clear</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>
      <input type="checkbox" id="selectAllCommon" onclick="toggleCommonSelectAll(this)">
      Barcode
    </th>
        <th>Item Name</th>
        <th>Book Count</th>
        <th>Physical Count</th>
        <th>User Counts</th>
        <th>Total</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="commonSummaryBody"></tbody>

  </table>

</div>

<!-- ================= AUDIT COMPARE ================= -->
<div id="audit" class="card tab-content hidden">

  <div class="card-header">
    <h3>Audit Compare</h3>

    <div class="header-actions">
      <div id="paginationAudit" class="pagination"></div>
    
    <button class="excel-btn" onclick="downloadAuditExcel()">
      ðŸ“Š Download Report
    </button>
    </div>
  </div>

  <div class="search-row">
    <input id="auditSearchInput" class="search-input" placeholder="Search barcode in audit..." onkeyup="searchAudit()">
    <button class="clear-btn" onclick="clearAuditSearch()">Clear</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Barcode</th>
        <th>Item Name</th>
        <th>Book Count</th>
        <th>Physical Count</th>
        <th>Status</th>
      </tr>
    </thead>

    <tbody id="auditBody"></tbody>
  </table>

</div>

</main>

<!-- ================= SCANNER OVERLAY ================= -->
<div id="scannerOverlay" class="scanner-overlay hidden">
  <button class="scanner-close" onclick="closeScanner()">âœ•</button>

  <div class="scanner-box">
    <div class="scanner-frame">
      <div id="reader"></div>
      <div id="scanFeedback" class="scan-feedback"></div>
    </div>

    <h3 class="scanner-title">Point camera at barcode</h3>
    <p class="scanner-hint">
      Hold steady and center the barcode in the box
    </p>
  </div>
</div>

<!-- ================= SCANNER EDITOR ================= -->
<div id="scanEditor" class="scan-editor-overlay hidden">
  <div class="scan-card">

    <button class="scan-close" onclick="cancelScanEdit()">âœ•</button>

    <h2>Scanned Item</h2>

    <label>Barcode</label>
    <input id="scanBarcode" disabled>

    <label>Item Name</label>
    <input id="scanItemName">

    <label>Book Count</label>
    <input id="scanBook" type="number">

    <label>Physical Count (Editable)</label>
    <input id="scanPhysical" type="number">

    <label>User Counts</label>
    <div id="scanUsers"></div>

    <label>Status</label>
    <div id="scanStatus"></div>

    <div class="scan-buttons">
      <button onclick="saveScanEdit()">Save</button>
      <button onclick="cancelScanEdit()">Cancel</button>
    </div>

  </div>
</div>

<!-- ================= EDIT MODAL ================= -->
<div id="editModal" class="edit-modal hidden">
  <div class="edit-box">

    <button class="edit-close" onclick="closeEditModal()">âœ•</button>

    <h3>Edit Barcode</h3>

    <label>Barcode</label>
    <input id="editBarcodeInput" type="text">

    <label>Physical Count</label>
    <input id="editQtyInput" type="number" min="0">

    <label>Item Name</label>
    <input id="editNameInput" type="text">

 
    <div class="edit-actions">
      <button class="save-btn" onclick="saveEdit()">Save</button>
    </div>

  </div>
</div>

<!-- ===== DELETE CONFIRM MODAL ===== -->
<div id="deleteConfirmOverlay" class="notify-overlay hidden">
  <div class="notify-box">
    <p id="deleteConfirmText">Delete selected barcodes?</p>

    <div style="margin-top:18px; display:flex; gap:12px; justify-content:center;">
      <button class="notify-btn" onclick="confirmDelete()">Yes Delete</button>
      <button class="clear-btn" onclick="closeDeleteConfirm()">Cancel</button>
    </div>

  </div>
</div>

<!-- ================= CUSTOM NOTIFICATION ================= -->
<div id="notifyOverlay" class="notify-overlay hidden">
  <div class="notify-box">
    <p id="notifyMessage"></p>
    <button class="notify-btn" onclick="closeNotify()">OK</button>
  </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script src="./script.js"></script>

<!-- FLOATING DELETE BUTTON -->
<div id="floatingDelete" class="floating-delete hidden">
  <button type="button" id="floatingDeleteBtn">
    ðŸ—‘ Delete Selected (<span id="deleteCount">0</span>)
  </button>
</div>

</body>
</html>
